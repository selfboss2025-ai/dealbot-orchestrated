version: '3.8'

services:
  # Bot Orchestrato - Coordinator + Worker UK in un unico container
  dealscout:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: dealscout
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - WORKER_BOT_TOKEN=${WORKER_BOT_TOKEN}
      - SOURCE_CHANNEL_ID=${SOURCE_CHANNEL_ID}
      - PUBLISH_CHANNEL_ID=${PUBLISH_CHANNEL_ID}
      - UK_CHANNEL=${UK_CHANNEL}
      - UK_CHANNEL_ID=${UK_CHANNEL_ID}
      - WORKER_UK_URL=http://127.0.0.1:8001
      - MIN_DISCOUNT_PERCENT=${MIN_DISCOUNT_PERCENT:-10}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TELEGRAM_API_ID=${TELEGRAM_API_ID}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH}
      - TELEGRAM_PHONE=${TELEGRAM_PHONE}
    ports:
      - "8000:8000"
      - "8001:8001"
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
